<!doctype html>
<html>
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Reset password</title></head>
<body style="font-family:Inter,system-ui;display:flex;align-items:center;justify-content:center;height:100vh;background:#071428;color:#fff">
  <div style="width:360px;padding:24px;background:rgba(255,255,255,0.03);border-radius:12px">
    <h3>Set a new password</h3>
    <input id="pw" type="password" placeholder="New password" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff">
    <button id="save" style="margin-top:10px;padding:10px 14px;border-radius:8px;background:#5fe3bf;border:0;cursor:pointer">Save new password</button>
    <div id="msg" style="margin-top:8px;color:#ffb3b3"></div>
  </div>

<script>
async function getToken(){ return new URLSearchParams(window.location.search).get('token'); }
document.getElementById('save').addEventListener('click', async ()=>{
  const pw = document.getElementById('pw').value;
  const token = await getToken();
  const msg = document.getElementById('msg'); msg.textContent='';
  if(!token){ msg.textContent='Invalid link'; return; }
  if(!pw){ msg.textContent='Enter new password'; return; }
  try{
    const res = await fetch('/api/reset-password', { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({ token, password: pw }) });
    const j = await res.json();
    if(res.ok){ msg.style.color='lightgreen'; msg.textContent=j.message || 'Password reset. Redirecting...'; setTimeout(()=> location.href='index.html',1200); }
    else { msg.style.color='#ffb3b3'; msg.textContent=j.error || 'Failed'; }
  } catch(e){ msg.style.color='#ffb3b3'; msg.textContent='Network error'; }
});
</script>
</body>
</html>
